lots of fancy javascript code